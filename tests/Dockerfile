# To be fully transparent this was just generated by chatgpt and then reviewed by me. Looks fine to me

FROM debian:bookworm
RUN apt-get update && apt-get install -y rsh-client rsh-server xinetd


# Configure xinetd to handle r-services
COPY rsh.xinetd /etc/xinetd.d/rsh
COPY rlogin.xinetd /etc/xinetd.d/rlogin
COPY rexec.xinetd /etc/xinetd.d/rexec

# Enable services
RUN echo "rsh stream tcp nowait root /usr/sbin/tcpd /usr/sbin/in.rshd" > /etc/inetd.conf && \
    echo "rlogin stream tcp nowait root /usr/sbin/tcpd /usr/sbin/in.rlogind" >> /etc/inetd.conf && \
    echo "rexec stream tcp nowait root /usr/sbin/tcpd /usr/sbin/in.rexecd" >> /etc/inetd.conf

# Add a test user
RUN useradd -m testuser && echo "testuser:testpass" | chpasswd

RUN echo "+ testuser" >> /etc/hosts.equiv
RUN echo "10.13.37.1 dockerhost" >> /etc/hosts

EXPOSE 512 513 514
# Start xinetd (it will handle the daemons)
CMD ["/usr/sbin/xinetd", "-dontfork"]
